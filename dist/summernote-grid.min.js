/**
 * Summernote Grid Plugin v2
 *
 * Kolonlari contenteditable izolasyonu ile korur.
 * Row: contenteditable=false (Summernote dokunmaz)
 * Col: contenteditable=true (bagimsiz editleme alani)
 */
!function(e){"use strict";var t=[{label:"2 Kolon",cols:[6,6]},{label:"3 Kolon",cols:[4,4,4]},{label:"4 Kolon",cols:[3,3,3,3]},{label:"6 Kolon",cols:[2,2,2,2,2,2]},{label:"12 Kolon",cols:[1,1,1,1,1,1,1,1,1,1,1,1]},{label:"8 + 4",cols:[8,4]},{label:"4 + 8",cols:[4,8]},{label:"9 + 3",cols:[9,3]},{label:"3 + 9",cols:[3,9]},{label:"3 + 6 + 3",cols:[3,6,3]},{label:"2 + 8 + 2",cols:[2,8,2]},{label:"4 + 4 + 4",cols:[4,4,4]}];e.extend(!0,e.summernote,{plugins:{gridPlugin:function(n){var i=e.summernote.ui,o=n.layoutInfo.editable,l=this;n.memo("button.grid",function(){return i.buttonGroup([i.button({className:"dropdown-toggle",contents:'<i class="bi bi-grid-3x2-gap"></i> <span class="note-icon-caret"></span>',tooltip:"Grid Ekle",data:{toggle:"dropdown"}}),i.dropdown({className:"dropdown-menu",contents:l.buildDropdown(),callback:function(n){n.find("[data-grid-index]").on("click",function(n){n.preventDefault(),n.stopPropagation(),l.insertGrid(t[e(this).data("grid-index")])})}})]).render()}),this.buildDropdown=function(){var n="";return e.each(t,function(t,i){var o='<span style="display:inline-flex;gap:1px;margin-right:8px;vertical-align:middle;">';e.each(i.cols,function(e,t){var n=Math.max(3,Math.round(3.5*t));o+='<span style="display:inline-block;width:'+n+'px;height:12px;background:#6c757d;border-radius:1px;"></span>'}),n+='<li><a class="dropdown-item" href="#" data-grid-index="'+t+'">'+(o+="</span>")+i.label+"</a></li>"}),n},this.insertGrid=function(t){var i=document.createElement("div");i.className="row sn-grid",i.setAttribute("contenteditable","false");for(var o=0;o<t.cols.length;o++){var a=document.createElement("div");a.className="col-md-"+t.cols[o]+" sn-grid-col",a.setAttribute("contenteditable","true"),a.innerHTML="<p><br></p>",i.appendChild(a)}var r=document.createElement("p");r.innerHTML="<br>",n.invoke("editor.insertNode",i),e(i).after(r),l.protectRow(e(i));var s=i.querySelector(".sn-grid-col");if(s){s.focus();var c=document.createRange(),d=window.getSelection();c.selectNodeContents(s.querySelector("p")||s),c.collapse(!0),d.removeAllRanges(),d.addRange(c)}},this.protectRow=function(t){t.find(".sn-grid-col").each(function(){var t=e(this);t.on("paste",function(t){t.stopPropagation(),t.preventDefault();var n=(t.originalEvent||t).clipboardData,i=n.getData("text/html"),o=n.getData("text/plain");if(i){var l=e("<div>").html(i);l.find("script,style,meta,link").remove(),i=l.html(),document.execCommand("insertHTML",!1,i)}else if(o){var a=e("<div>").text(o).html().replace(/\n/g,"<br>");document.execCommand("insertHTML",!1,a)}}),t.on("keydown",function(e){if("Backspace"===e.key||"Delete"===e.key){var n=this.innerHTML.replace(/<br\s*\/?>/gi,"").replace(/<p>\s*<\/p>/gi,"").trim();n&&""!==n||(e.preventDefault(),this.innerHTML="<p><br></p>")}if("Tab"===e.key){e.preventDefault(),e.stopPropagation();var i=t.siblings(".sn-grid-col").addBack(),o=i.index(t),l=e.shiftKey?i.eq(o-1):i.eq(o+1);l.length&&l.focus()}}),t.on("drop",function(e){e.stopPropagation()})})},this.activeCol=null,o.on("focusin",".sn-grid-col",function(){l.activeCol=this}),o.on("focusout",".sn-grid-col",function(){var t=this;setTimeout(function(){l.activeCol===t&&e(document.activeElement).closest(".sn-grid-col").length},200)}),this.initialize=function(){o.find(".sn-grid").each(function(){e(this).attr("contenteditable","false"),e(this).find(".sn-grid-col").attr("contenteditable","true"),l.protectRow(e(this))}),o.find(".row:not(.sn-grid)").each(function(){var t=e(this);t.children('[class*="col-"]').length>0&&(t.addClass("sn-grid").attr("contenteditable","false"),t.children('[class*="col-"]').addClass("sn-grid-col").attr("contenteditable","true"),l.protectRow(t))})},o.on("click",".sn-grid",function(t){if(e(t.target).hasClass("sn-grid")){var n=e(this);o.find(".sn-grid-delete").remove();var i=e('<button type="button" class="sn-grid-delete" title="Grid\'i sil">&times;</button>');n.css("position","relative").prepend(i),i.on("click",function(e){e.preventDefault(),e.stopPropagation(),n.remove()})}}),o.on("click",function(t){e(t.target).closest(".sn-grid").length||o.find(".sn-grid-delete").remove()})}}})}(jQuery);