!function(e){"use strict";var t=[{label:"2 Kolon",cols:[6,6]},{label:"3 Kolon",cols:[4,4,4]},{label:"4 Kolon",cols:[3,3,3,3]},{label:"6 Kolon",cols:[2,2,2,2,2,2]},{label:"12 Kolon",cols:[1,1,1,1,1,1,1,1,1,1,1,1]},{label:"8 + 4",cols:[8,4]},{label:"4 + 8",cols:[4,8]},{label:"9 + 3",cols:[9,3]},{label:"3 + 9",cols:[3,9]},{label:"3 + 6 + 3",cols:[3,6,3]},{label:"2 + 8 + 2",cols:[2,8,2]},{label:"4 + 4 + 4",cols:[4,4,4]}];e.extend(!0,e.summernote,{plugins:{gridPlugin:function(n){var o=e.summernote.ui,i=n.layoutInfo.editable,l=this;this.lastActiveCol=null,this.lastRange=null,n.memo("button.grid",function(){return o.buttonGroup([o.button({className:"dropdown-toggle",contents:'<i class="bi bi-grid-3x2-gap"></i> <span class="note-icon-caret"></span>',tooltip:"Grid Ekle",data:{toggle:"dropdown"}}),o.dropdown({className:"dropdown-menu",contents:l.buildDropdown(),callback:function(n){n.find("[data-grid-index]").on("click",function(n){n.preventDefault(),n.stopPropagation(),l.insertGrid(t[e(this).data("grid-index")])})}})]).render()}),this.buildDropdown=function(){var n="";return e.each(t,function(t,o){var i='<span style="display:inline-flex;gap:1px;margin-right:8px;vertical-align:middle;">';e.each(o.cols,function(e,t){var n=Math.max(3,Math.round(3.5*t));i+='<span style="display:inline-block;width:'+n+'px;height:12px;background:#6c757d;border-radius:1px;"></span>'}),n+='<li><a class="dropdown-item" href="#" data-grid-index="'+t+'">'+(i+="</span>")+o.label+"</a></li>"}),n},this.insertGrid=function(t){var o=document.createElement("div");o.className="row sn-grid",o.setAttribute("contenteditable","false");for(var i=0;i<t.cols.length;i++){var a=document.createElement("div");a.className="col-md-"+t.cols[i]+" sn-grid-col",a.setAttribute("contenteditable","true"),a.innerHTML="<p><br></p>",o.appendChild(a)}var r=document.createElement("p");r.innerHTML="<br>",n.invoke("editor.insertNode",o),e(o).after(r),l.protectRow(e(o)),l.focusCol(o.querySelector(".sn-grid-col"))},this.focusCol=function(e){if(e){e.focus();var t=document.createRange(),n=window.getSelection(),o=e.querySelector("p")||e;t.selectNodeContents(o),t.collapse(!0),n.removeAllRanges(),n.addRange(t),l.lastActiveCol=e,l.lastRange=t.cloneRange()}},this.protectRow=function(t){t.find(".sn-grid-col").each(function(){var t=e(this);t.on("paste",function(t){t.stopPropagation(),t.preventDefault();var n=(t.originalEvent||t).clipboardData,o=n.getData("text/html"),i=n.getData("text/plain");if(o){var l=e("<div>").html(o);l.find("script,style,meta,link").remove(),o=l.html(),document.execCommand("insertHTML",!1,o)}else if(i){var a=e("<div>").text(i).html().replace(/\n/g,"<br>");document.execCommand("insertHTML",!1,a)}}),t.on("keydown",function(e){if("Backspace"===e.key||"Delete"===e.key){var n=this.innerHTML.replace(/<br\s*\/?>/gi,"").replace(/<p>\s*<\/p>/gi,"").trim();n&&""!==n||(e.preventDefault(),this.innerHTML="<p><br></p>")}if("Tab"===e.key){e.preventDefault(),e.stopPropagation();var o=t.siblings(".sn-grid-col").addBack(),i=o.index(t),a=e.shiftKey?o.eq(i-1):o.eq(i+1);a.length&&l.focusCol(a[0])}}),t.on("drop",function(e){e.stopPropagation()})})},i.on("mousedown",".sn-grid-col",function(){l.lastActiveCol=this}),i.on("focusin",".sn-grid-col",function(){l.lastActiveCol=this}),document.addEventListener("selectionchange",function(){var t=window.getSelection();if(t.rangeCount>0){var n=t.getRangeAt(0),o=n.startContainer,a=e(o).closest(".sn-grid-col");a.length&&e.contains(i[0],a[0])&&(l.lastActiveCol=a[0],l.lastRange=n.cloneRange())}});var a=null;this.initialize=function(){var t=n.modules.editor;t&&t.insertNode&&(a=t.insertNode.bind(t),t.insertNode=function(t){if(l.lastActiveCol&&e.contains(i[0],l.lastActiveCol)){var n=l.lastActiveCol;if(l.lastRange){var o=window.getSelection();o.removeAllRanges(),o.addRange(l.lastRange)}try{a(t)}catch(e){n.appendChild(t)}}else a(t)}),i.find(".sn-grid").each(function(){e(this).attr("contenteditable","false"),e(this).find(".sn-grid-col").attr("contenteditable","true"),l.protectRow(e(this))}),i.find(".row:not(.sn-grid)").each(function(){var t=e(this);t.children('[class*="col-"]').length>0&&(t.addClass("sn-grid").attr("contenteditable","false"),t.children('[class*="col-"]').addClass("sn-grid-col").attr("contenteditable","true"),l.protectRow(t))})},n.memo("help.grid.clean",function(){return"Grid cleanup on code retrieval"});var r=n.$note||n.layoutInfo.note;r&&r.data("summernote")&&setTimeout(function(){var e=r.data("summernote");if(e&&e.code){var t=e.code;e.code=function(n){if("string"==typeof n)return t.call(e,n);var o=t.call(e);return l.cleanHTML(o)}}},100),this.cleanHTML=function(t){var n=e("<div>").html(t);return n.find(".sn-grid").removeAttr("contenteditable"),n.find(".sn-grid-col").removeAttr("contenteditable"),n.find(".sn-grid-delete").remove(),n.html()},i.on("click",".sn-grid",function(t){if(e(t.target).hasClass("sn-grid")){var n=e(this);i.find(".sn-grid-delete").remove();var o=e('<button type="button" class="sn-grid-delete" title="Grid\'i sil">&times;</button>');n.css("position","relative").prepend(o),o.on("click",function(e){e.preventDefault(),e.stopPropagation(),n.remove()})}}),i.on("click",function(t){e(t.target).closest(".sn-grid").length||i.find(".sn-grid-delete").remove()})}}})}(jQuery);